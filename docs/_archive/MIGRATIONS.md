# Database Migrations - Philosophy & Best Practices

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 15 –æ–∫—Ç—è–±—Ä—è 2025
**–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞:** –†–µ–∞–ª—å–Ω—ã–π –æ–ø—ã—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π

---

## üéØ –ì–ª–∞–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. Database is Source of Truth

```
Git (–∫–æ–¥) –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å ‚Üê ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –≤–ø–µ—Ä—ë–¥
     ‚Üì                                    ‚Üì
 git reset --hard                  Forward-only migrations
 git revert                        –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∏–∑ —Å–µ—Ä–µ–¥–∏–Ω—ã
```

**–ü—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ –±–∞–∑–∞ –∏ –∫–æ–¥ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å - **–ø–æ–¥–≥–æ–Ω—è–π –∫–æ–¥ –ø–æ–¥ –±–∞–∑—É**, –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç.

---

## üìã –ß—Ç–æ —Ç–∞–∫–æ–µ –º–∏–≥—Ä–∞—Ü–∏—è?

**–ú–∏–≥—Ä–∞—Ü–∏—è = –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏**

```
–ú–∏–≥—Ä–∞—Ü–∏—è ‚â† –°—É—â–Ω–æ—Å—Ç—å
–ú–∏–≥—Ä–∞—Ü–∏—è = –°–æ–±—ã—Ç–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏

–ü—Ä–∏–º–µ—Ä:
- –¢–∞–±–ª–∏—Ü–∞ deals = —Å—É—â–Ω–æ—Å—Ç—å (–∂–∏–≤—ë—Ç –≤—Å–µ–≥–¥–∞)
- Migration 001 = "–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É deals" (—Å–æ–±—ã—Ç–∏–µ 1 –æ–∫—Ç—è–±—Ä—è)
- Migration 015 = "–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ status" (—Å–æ–±—ã—Ç–∏–µ 10 –æ–∫—Ç—è–±—Ä—è)
- Migration 027 = "–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –Ω–∞ status" (—Å–æ–±—ã—Ç–∏–µ 13 –æ–∫—Ç—è–±—Ä—è)

–û–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ ‚Üí –º–Ω–æ–≥–æ –º–∏–≥—Ä–∞—Ü–∏–π –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è
```

---

## üîÑ Git vs Database Migrations

| –ê—Å–ø–µ–∫—Ç | Git Commits | Database Migrations |
|--------|-------------|---------------------|
| **–û—Ç–∫–∞—Ç** | ‚úÖ –õ–µ–≥–∫–æ (`git reset`, `git revert`) | ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ (–º–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ) |
| **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏** | ‚úÖ –ú–æ–∂–Ω–æ (`git rebase`) | ‚ùå –ù–µ–ª—å–∑—è (–∏—Å—Ç–æ—Ä–∏—è immutable) |
| **–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ —Å–µ—Ä–µ–¥–∏–Ω—ã** | ‚úÖ –ú–æ–∂–Ω–æ | ‚ùå –ù–µ–ª—å–∑—è (–Ω–∞—Ä—É—à–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏) |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ‚úÖ –¢–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã | ‚ö†Ô∏è –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |

---

## ‚öôÔ∏è Workflow: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
touch migrations/035_add_user_roles.sql

# 2. –ù–∞–ø–∏—Å–∞—Ç—å SQL
cat > migrations/035_add_user_roles.sql << 'EOF'
CREATE TABLE user_roles (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  role TEXT NOT NULL
);
EOF

# 3. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –§–ê–ô–õ –º–∏–≥—Ä–∞—Ü–∏–∏
git add migrations/035_add_user_roles.sql
git commit -m "Migration 035: Add user roles table"

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤ –±–∞–∑—É —á–µ—Ä–µ–∑ MCP/CLI
# (–∑–∞–ø–∏—à–µ—Ç—Å—è –≤ supabase_migrations.schema_migrations)

# 5. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –ø–æ–¥ –Ω–æ–≤—É—é —Å—Ö–µ–º—É
# ... –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ ...

# 6. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∫–æ–¥
git add .
git commit -m "feat: Add user roles feature (migration 035)"

# 7. –ü—É—à
git push
```

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:

```bash
# 1. –û—Ç–∫—Ä—ã—Ç—å SQL Editor
# 2. CREATE TABLE user_roles ...
# 3. Run

# ‚ùå –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–ø–∏—Å–∞–ª–∞—Å—å –≤ schema_migrations!
# ‚ùå –ù–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
# ‚ùå Git –Ω–µ –∑–Ω–∞–µ—Ç –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏
# ‚ùå –ü—Ä–∏ –æ—Ç–∫–∞—Ç–µ –∫–æ–¥–∞ –±–∞–∑–∞ –±—É–¥–µ—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
```

---

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

### 1. Supabase CLI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
npm install -g supabase

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
supabase init

# –õ–∏–Ω–∫ –∫ –ø—Ä–æ–µ–∫—Ç—É
supabase link --project-ref YOUR_PROJECT_ID

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
supabase migration new add_user_roles

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
supabase db push

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é
supabase migration revert

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å diff —Å production
supabase db diff
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Local development database
- ‚úÖ Rollback support
- ‚úÖ Diff —Å production

### 2. MCP Tool (–¥–ª—è Claude Code)

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
mcp__supabase__apply_migration(
  project_id: "xxx",
  name: "035_add_user_roles",
  query: "CREATE TABLE ..."
)

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫
mcp__supabase__list_migrations(project_id: "xxx")
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Claude
- ‚úÖ –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ schema_migrations
- ‚úÖ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ —á–∞—Ç–∞

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ù–µ—Ç rollback
- ‚ö†Ô∏è –ù–µ—Ç local database

### 3. SQL Editor (–¢–û–õ–¨–ö–û –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞!)

**‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è:**
- Debugging (SELECT –∑–∞–ø—Ä–æ—Å—ã)
- Analytics (–æ—Ç—á—ë—Ç—ã)
- Hotfix (—Å—Ä–æ—á–Ω—ã–π —Ñ–∏–∫—Å, –ø–æ—Ç–æ–º –æ—Ñ–æ—Ä–º–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–µ–π!)
- Testing SQL –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏

**‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –¥–ª—è:**
- CREATE TABLE / ALTER TABLE
- CREATE INDEX
- CREATE FUNCTION
- –õ—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã

---

## üìù –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

### –ì–¥–µ Supabase —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é:

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
SELECT * FROM supabase_migrations.schema_migrations;

-- –ö–æ–ª–æ–Ω–∫–∏:
-- version          : "20251014140237" (timestamp —Å–æ–∑–¥–∞–Ω–∏—è)
-- name             : "034_add_call_metrics_to_dashboard"
-- statements       : [–º–∞—Å—Å–∏–≤ SQL –∫–æ–º–∞–Ω–¥]
-- created_by       : "leo@systemhustle.com"
-- idempotency_key  : —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∑–∞–ø–∏—Å–∞–Ω–æ:

```sql
-- –í—Å–µ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
SELECT
  version,
  name,
  created_by
FROM supabase_migrations.schema_migrations
ORDER BY version ASC;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
SELECT EXISTS (
  SELECT 1
  FROM supabase_migrations.schema_migrations
  WHERE name = '035_add_user_roles'
) as is_applied;
```

---

## üö® –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏?

### –°–∏—Ç—É–∞—Ü–∏—è: –û—Ç–∫–∞—Ç–∏–ª –∫–æ–¥, –Ω–æ –±–∞–∑–∞ –æ—Å—Ç–∞–ª–∞—Å—å

```
Git:      [commit abc123] ‚Üê –æ—Ç–∫–∞—Ç–∏–ª—Å—è, –∫–æ–¥ —Å—Ç–∞—Ä—ã–π
Database: [migration 035 applied] ‚Üê –±–∞–∑–∞ –Ω–æ–≤–∞—è

–†–µ–∑—É–ª—å—Ç–∞—Ç: MISMATCH ‚Üí 500 error
```

### ‚úÖ –†–µ—à–µ–Ω–∏–µ: Forward-only –ø–æ–¥—Ö–æ–¥

**–ù–ï –æ—Ç–∫–∞—Ç—ã–≤–∞–π –±–∞–∑—É!** –ü–æ–¥–≥–æ–Ω–∏ –∫–æ–¥ –ø–æ–¥ –±–∞–∑—É:

```bash
# 1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
git show <commit>:migrations/035_xxx.sql > migrations/035_xxx.sql

# 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –ø–æ–¥ –Ω–æ–≤—É—é —Å—Ö–µ–º—É
git show <commit>:path/to/file.ts > path/to/file.ts

# 3. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
git add .
git commit -m "fix: Restore code to match database schema (migration 035)"

# 4. –ü—É—à
git push
```

**–ö–æ–≥–¥–∞ –ú–û–ñ–ù–û –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –±–∞–∑—É:**
- ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å –ø–æ—Ç–µ—Ä–µ–π –¥–∞–Ω–Ω—ã—Ö
- ‚ö†Ô∏è –ü–æ–ª–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ production
- ‚ö†Ô∏è –ú–∏–≥—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ (< 5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥)
- ‚úÖ –ï—Å—Ç—å —Å–≤–µ–∂–∏–π –±—ç–∫–∞–ø

---

## üîß –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã

### 1. –û–¥–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è = –æ–¥–Ω–∞ —Ñ–∏—á–∞

```
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
035_add_user_roles.sql          (—Ç–æ–ª—å–∫–æ —Ä–æ–ª–∏)
036_add_user_permissions.sql    (—Ç–æ–ª—å–∫–æ permissions)

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
035_add_everything.sql          (—Ä–æ–ª–∏ + permissions + indexes + ...)
```

### 2. –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å idempotent

```sql
-- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
CREATE TABLE IF NOT EXISTS users (...);
CREATE OR REPLACE FUNCTION get_users() ...;

-- ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: —É–ø–∞–¥—ë—Ç –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ
CREATE TABLE users (...);  -- ERROR: relation already exists
```

### 3. –¢–µ—Å—Ç–∏—Ä—É–π –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥ production

```bash
# 1. –°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é
supabase migration new test_feature

# 2. –ü—Ä–∏–º–µ–Ω–∏ –ª–æ–∫–∞–ª—å–Ω–æ
supabase db reset

# 3. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
# 4. –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º push –≤ production
supabase db push
```

### 4. –ë—ç–∫–∞–ø—ã –ø–µ—Ä–µ–¥ –∫—Ä—É–ø–Ω—ã–º–∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

```bash
# –í Supabase UI:
Database ‚Üí Backups ‚Üí Create backup

# –ò–ª–∏ pg_dump:
pg_dump -h db.xxx.supabase.co -U postgres > backup.sql
```

### 5. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```
–ú–û–ñ–ù–û —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:
‚úÖ –î–û –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ production (–ª–æ–∫–∞–ª—å–Ω–æ)

–ù–ï–õ–¨–ó–Ø —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å:
‚ùå –ü–û–°–õ–ï –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ production
   ‚Üí –°–æ–∑–¥–∞–π –ù–û–í–£–Æ –º–∏–≥—Ä–∞—Ü–∏—é
```

---

## üìö –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```
–ú–∏–≥—Ä–∞—Ü–∏–∏ 001-022:
‚ùå –ü—Ä–∏–º–µ–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ SQL Editor
‚ùå –ù–ï –∑–∞–ø–∏—Å–∞–Ω—ã –≤ schema_migrations
‚ùå –ù–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –ë–∞–∑–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ù–æ –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π
- –°–ª–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å
```

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–∏–ª–∏:

```
–ú–∏–≥—Ä–∞—Ü–∏–∏ 023, 029-034:
‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ MCP
‚úÖ –ó–∞–ø–∏—Å–∞–Ω—ã –≤ schema_migrations
‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è

Workflow:
‚úÖ –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏
‚úÖ git commit
‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ–º —á–µ—Ä–µ–∑ MCP
‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º
‚úÖ git push
```

### –£—Ä–æ–∫ –∏–∑ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (14-15 –æ–∫—Ç 2025):

```
–ü—Ä–æ–±–ª–µ–º–∞:
1. –°–æ–∑–¥–∞–ª–∏ migration 034 + –∫–æ–¥
2. –ü—Ä–∏–º–µ–Ω–∏–ª–∏ –≤ –±–∞–∑—É
3. git push
4. –ü–æ—Ç–æ–º: git reset --hard (–æ—Ç–∫–∞—Ç–∏–ª–∏ –∫–æ–¥)
5. –ë–∞–∑–∞ –æ—Å—Ç–∞–ª–∞—Å—å —Å migration 034
6. –ö–æ–¥ –∂–¥—ë—Ç —Å—Ç–∞—Ä—É—é —Å—Ö–µ–º—É
   ‚Üí 500 error

–†–µ—à–µ–Ω–∏–µ:
‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –∫–æ–¥ –ø–æ–¥ –±–∞–∑—É (forward-only)
‚ùå –ù–ï –æ—Ç–∫–∞—Ç—ã–≤–∞–ª–∏ –±–∞–∑—É (–º–æ–≥–ª–∞ –±—ã –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö)
```

---

## üéØ Checklist –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π

```
‚ñ° –§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω –≤ migrations/
‚ñ° SQL –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –≤ SQL Editor (SELECT –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)
‚ñ° git commit —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
‚ñ° –ü—Ä–∏–º–µ–Ω–∏–ª —á–µ—Ä–µ–∑ MCP/CLI (–ù–ï —á–µ—Ä–µ–∑ SQL Editor!)
‚ñ° –ü—Ä–æ–≤–µ—Ä–∏–ª —á—Ç–æ –∑–∞–ø–∏—Å–∞–ª–æ—Å—å –≤ schema_migrations
‚ñ° –û–±–Ω–æ–≤–∏–ª –∫–æ–¥ –ø–æ–¥ –Ω–æ–≤—É—é —Å—Ö–µ–º—É
‚ñ° git commit –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞
‚ñ° –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –ª–æ–∫–∞–ª—å–Ω–æ
‚ñ° git push
‚ñ° –ü—Ä–æ–≤–µ—Ä–∏–ª –≤ production
```

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Supabase CLI Docs](https://supabase.com/docs/guides/cli)
- [Database Migrations Best Practices](https://www.prisma.io/dataguide/types/relational/migration-strategies)
- [Forward-only migrations](https://flywaydb.org/documentation/concepts/migrations)

---

## üîÑ –ü–æ–ª–µ–∑–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π

```sql
-- scripts/utils/check-migrations.sql

-- –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
SELECT
  version,
  name,
  created_by
FROM supabase_migrations.schema_migrations
ORDER BY version ASC;

-- –ü–æ—Å–ª–µ–¥–Ω—è—è –º–∏–≥—Ä–∞—Ü–∏—è
SELECT
  version,
  name
FROM supabase_migrations.schema_migrations
ORDER BY version DESC
LIMIT 1;

-- –ü–æ—Å—á–∏—Ç–∞—Ç—å —Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ
SELECT COUNT(*) as total_migrations
FROM supabase_migrations.schema_migrations;
```

### –°–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –±–∞–∑–æ–π

```bash
# scripts/utils/verify-migrations.sh

# –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
ls -1 migrations/*.sql | wc -l

# –°–ø–∏—Å–æ–∫ –≤ –±–∞–∑–µ
psql -c "SELECT COUNT(*) FROM supabase_migrations.schema_migrations"

# –†–∞–∑–Ω–∏—Ü–∞ = –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ SQL Editor (–Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è)
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 15 –æ–∫—Ç—è–±—Ä—è 2025
**–ê–≤—Ç–æ—Ä:** –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –æ–ø—ã—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞ mudrek-dashboard
