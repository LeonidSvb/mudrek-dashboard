# üöÄ WORKFLOW: –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-10-21

## üìã –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç

### –¢—ã –≥–æ–≤–æ—Ä–∏—à—å –º–Ω–µ:
```
"–°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏"
```

### –Ø –¥–µ–ª–∞—é:
1. –°–æ–∑–¥–∞—é —Ñ–∞–π–ª: `npx supabase migration new add_column`
2. –ü–∏—à—É SQL
3. –ü—Ä–∏–º–µ–Ω—è—é: `npx supabase db push`
4. –ì–æ—Ç–æ–≤–æ! ‚úÖ

---

## üéØ –ö–æ–º–∞–Ω–¥—ã

### 1. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

**–ß–µ—Ä–µ–∑ –º–µ–Ω—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```
–¢—ã: "–°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è X"
–Ø: *—Å–æ–∑–¥–∞—é + –ø–∏—à—É SQL + –ø—Ä–∏–º–µ–Ω—è—é*
```

**–°–∞–º (–µ—Å–ª–∏ —Ö–æ—á–µ—à—å):**
```bash
npx supabase migration new feature_name
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—à—å: supabase/migrations/20251022_xxx_feature_name.sql
```

### 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

**–ß–µ—Ä–µ–∑ –º–µ–Ω—è:**
```
–¢—ã: "–ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏–∏"
–Ø: npx supabase db push
```

**–°–∞–º:**
```bash
export SUPABASE_ACCESS_TOKEN="sbp_95f2d6ec74f269247ac312303ec943f7b9d52e2d"
npx supabase db push
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å

```bash
npx supabase migration list
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –§–∞–π–ª–æ–≤

```
project/
‚îú‚îÄ‚îÄ supabase/                    ‚Üê –°—Épabase CLI
‚îÇ   ‚îú‚îÄ‚îÄ config.toml
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îú‚îÄ‚îÄ 20251021163342_baseline.sql    ‚Üê BASELINE (—Ç–æ—á–∫–∞ –æ—Ç—Å—á–µ—Ç–∞)
‚îÇ       ‚îú‚îÄ‚îÄ 20251022100000_add_feature.sql ‚Üê –ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ archive/                     ‚Üê –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (–ù–ï —Ç—Ä–æ–≥–∞—Ç—å!)
‚îÇ   ‚îú‚îÄ‚îÄ BASELINE.md
‚îÇ   ‚îî‚îÄ‚îÄ old-migrations/
‚îÇ       ‚îî‚îÄ‚îÄ *.sql (51 —Ñ–∞–π–ª)
‚îÇ
‚îî‚îÄ‚îÄ migrations/                  ‚Üê –ü–£–°–¢–ê–Ø (–≤—Å—ë –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ archive/)
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
- –í—Å–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Supabase CLI
- –§–∞–π–ª—ã –≤ `supabase/migrations/`
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `npx supabase db push`
- –ì–æ–≤–æ—Ä–∏—Ç—å –º–Ω–µ "—Å–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é"

### ‚ùå –ù–ï –¥–µ–ª–∞–π:
- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π —Ñ–∞–π–ª—ã –≤ `migrations/` (–∏—Å–ø–æ–ª—å–∑—É–π `supabase/migrations/`)
- –ù–ï –ø—Ä–∏–º–µ–Ω—è–π —á–µ—Ä–µ–∑ SQL Editor
- –ù–ï –ø—Ä–∏–º–µ–Ω—è–π —á–µ—Ä–µ–∑ MCP –≤—Ä—É—á–Ω—É—é
- –ù–ï —Ç—Ä–æ–≥–∞–π `archive/old-migrations/`

---

## üîÑ –¢–∏–ø–∏—á–Ω—ã–π Workflow

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É

```
–¢—ã: "–î–æ–±–∞–≤—å –∫–æ–ª–æ–Ω–∫—É email_verified –≤ —Ç–∞–±–ª–∏—Ü—É contacts"

–Ø:
1. –°–æ–∑–¥–∞—é: supabase/migrations/20251022_add_email_verified.sql
2. –ü–∏—à—É SQL:
   ALTER TABLE contacts ADD COLUMN email_verified BOOLEAN DEFAULT FALSE;
3. –ü—Ä–∏–º–µ–Ω—è—é: npx supabase db push
4. ‚úÖ Done!
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é

```
–¢—ã: "–°–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ average deal size"

–Ø:
1. –°–æ–∑–¥–∞—é: supabase/migrations/20251022_add_avg_deal_size_function.sql
2. –ü–∏—à—É SQL:
   CREATE OR REPLACE FUNCTION get_avg_deal_size() ...
3. –ü—Ä–∏–º–µ–Ω—è—é: npx supabase db push
4. ‚úÖ Done!
```

---

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å

### –ü—Ä–æ–±–ª–µ–º–∞: "Migration failed"

```
–¢—ã: "–ú–∏–≥—Ä–∞—Ü–∏—è —É–ø–∞–ª–∞ —Å –æ—à–∏–±–∫–æ–π"
–Ø: *—Å–º–æ—Ç—Ä—é –ª–æ–≥–∏*
–Ø: *–∏—Å–ø—Ä–∞–≤–ª—è—é SQL –≤ —Ñ–∞–π–ª–µ*
–Ø: *–ø—Ä–∏–º–µ–Ω—è—é –∑–∞–Ω–æ–≤–æ*
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ó–∞–±—ã–ª –∫–∞–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã"

```bash
npx supabase migration list
# –ü–æ–∫–∞–∂–µ—Ç: applied/pending –º–∏–≥—Ä–∞—Ü–∏–∏
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –Ω–µ –ø–æ–Ω—è—Ç–Ω–æ - –ø—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏:
```
"–ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é?"
"–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π"
"–°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è X"
```

–Ø –≤—Å—ë —Å–¥–µ–ª–∞—é! üöÄ
